{"version":3,"sources":["webpack:///./src/app/pages/chat-messages/chat-messages.module.ts","webpack:///./src/app/pages/chat-messages/chat-messages.page.html","webpack:///./src/app/pages/chat-messages/chat-messages.page.scss","webpack:///./src/app/pages/chat-messages/chat-messages.page.ts"],"names":[],"mappings":"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","file":"pages-chat-messages-chat-messages-module.js","sourcesContent":["import { CUSTOM_ELEMENTS_SCHEMA, NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { Routes, RouterModule } from '@angular/router';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { ChatMessagesPage } from './chat-messages.page';\r\nimport { AutoresizeModule } from '../../directives/autoresize/autoresize.module';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: ChatMessagesPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [\r\n    AutoresizeModule,\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    RouterModule.forChild(routes),\r\n    ReactiveFormsModule\r\n  ],\r\n  declarations: [ChatMessagesPage],\r\n  schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n})\r\nexport class ChatMessagesPageModule {\r\n}\r\n","module.exports = \"<ion-header>\\r\\n  <ion-toolbar>\\r\\n    <ion-buttons slot=\\\"start\\\">\\r\\n      <ion-back-button defaultHref=\\\"/trainer-messages\\\"></ion-back-button>\\r\\n    </ion-buttons>\\r\\n    <ion-title>Messages w/ {{ name }}</ion-title>\\r\\n      <ion-buttons slot=\\\"end\\\">\\r\\n          <ion-button (click)=\\\"viewTransphormer()\\\"><ion-icon slot=\\\"icon-only\\\"\\r\\n                                                         color=\\\"primary\\\"\\r\\n                                                         name=\\\"search\\\"\\r\\n                                                         size=\\\"large\\\"></ion-icon>\\r\\n          </ion-button>\\r\\n      </ion-buttons>\\r\\n  </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n<div id=\\\"messaging-page\\\">\\r\\n  <ion-content #messageContent class=\\\"message-listing\\\">\\r\\n    <ion-item-sliding class=\\\"chat-wrapper\\\" *ngFor=\\\"let message of messages\\\" [class.chat-wrapper-receiver]=\\\"message.from_id === user.id\\\">\\r\\n      <ion-item [lines]=\\\"'none'\\\" >\\r\\n<div class=\\\"msg-block\\\" [class.chat-receiver]=\\\"message.from_id !== user.id\\\" [class.chat-sender]=\\\"message.from_id === user.id\\\">\\r\\n          <p class=\\\"text\\\" [innerHTML]=\\\"message.message\\\"></p>\\r\\n          <div class=\\\"time\\\">{{ message.from_id === user.id ? 'Sent' : 'Received' }} {{ time(message.created_at) }}</div>\\r\\n        </div>\\r\\n      </ion-item>\\r\\n    </ion-item-sliding>\\r\\n  </ion-content>\\r\\n\\r\\n  <div class=\\\"messaging\\\">\\r\\n    <form [formGroup]=\\\"messageForm\\\" (ngSubmit)=\\\"sendMessage()\\\">\\r\\n      <div id=\\\"message-entry\\\">\\r\\n        <ion-textarea autocapitalize=\\\"on\\\" appAutoresize (resize)=\\\"scrollBottom()\\\" formControlName=\\\"message\\\" placeholder=\\\"Message\\\"></ion-textarea>\\r\\n        <ion-button type=\\\"submit\\\" fill=\\\"clear\\\" [disabled]=\\\"messageForm.invalid\\\">\\r\\n          <ion-icon name=\\\"send\\\" slot=\\\"icon-only\\\"></ion-icon>\\r\\n        </ion-button>\\r\\n      </div>\\r\\n    </form>\\r\\n  </div>\\r\\n</div>\\r\\n\"","module.exports = \"ion-list, .message-listing {\\n  padding: 5px 0;\\n  flex: 1;\\n  overflow-y: scroll;\\n  display: flex;\\n  flex-direction: column; }\\n\\n.text {\\n  font-size: 12px;\\n  white-space: pre-line; }\\n\\n.chat-wrapper {\\n  width: 100%;\\n  margin: 15px 0; }\\n\\n.chat-wrapper ion-item {\\n    --border-width: 0 !important; }\\n\\n.chat-wrapper .text {\\n    padding-bottom: 5px;\\n    margin: 5px;\\n    font-size: 13pt; }\\n\\n.msg-block {\\n  padding: 5px 10px;\\n  margin-bottom: 10px; }\\n\\n.chat-sender {\\n  background-color: #d3d3d3;\\n  margin-left: auto; }\\n\\n.chat-sender .text {\\n    text-align: right; }\\n\\n.chat-sender .time {\\n    font-size: 10pt;\\n    text-align: right; }\\n\\n.chat-receiver {\\n  background-color: #aed8e6;\\n  margin-right: auto; }\\n\\n.chat-receiver .text {\\n    text-align: left; }\\n\\n.chat-receiver .time {\\n    font-size: 10pt;\\n    text-align: left; }\\n\\n.messaging {\\n  min-height: 45px;\\n  width: 100vw;\\n  background: #000; }\\n\\n.danger {\\n  color: var(--ion-color-danger); }\\n\\n#messaging-page {\\n  display: flex;\\n  flex-direction: column;\\n  height: 100%; }\\n\\n#message-entry {\\n  padding: 5px;\\n  display: flex;\\n  width: 100vw;\\n  flex-direction: row;\\n  align-items: flex-end; }\\n\\n#message-entry ion-textarea {\\n    border: 1px solid #cccccc;\\n    background: #fff;\\n    height: 36px;\\n    min-height: 36px;\\n    --padding-top: 5px;\\n    --padding-end: 5px;\\n    --padding-bottom: 5px; }\\n\\n#message-entry ion-button {\\n    margin: 0;\\n    --padding-start: 8px;\\n    --padding-end: 2px; }\\n\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvcGFnZXMvY2hhdC1tZXNzYWdlcy9FOlxcaW9uaWNcXFZlcnZlQ29tbWVyY2VcXE5ld0RldlxcbXRzdC1hcHAvc3JjXFxhcHBcXHBhZ2VzXFxjaGF0LW1lc3NhZ2VzXFxjaGF0LW1lc3NhZ2VzLnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGNBQWM7RUFDZCxPQUFPO0VBQ1Asa0JBQWtCO0VBQ2xCLGFBQWE7RUFDYixzQkFBc0IsRUFBQTs7QUFHeEI7RUFDRSxlQUFlO0VBQ2YscUJBQXFCLEVBQUE7O0FBR3ZCO0VBQ0UsV0FBVztFQUNYLGNBQWMsRUFBQTs7QUFGaEI7SUFLSSw0QkFBZSxFQUFBOztBQUxuQjtJQVNJLG1CQUFtQjtJQUNuQixXQUFXO0lBQ1gsZUFBZSxFQUFBOztBQUluQjtFQUNFLGlCQUFpQjtFQUNqQixtQkFBbUIsRUFBQTs7QUFHckI7RUFDRSx5QkFBeUI7RUFDekIsaUJBQWlCLEVBQUE7O0FBRm5CO0lBS0ksaUJBQWlCLEVBQUE7O0FBTHJCO0lBU0ksZUFBZTtJQUNmLGlCQUFpQixFQUFBOztBQUlyQjtFQUNFLHlCQUF5QjtFQUN6QixrQkFBa0IsRUFBQTs7QUFGcEI7SUFLSSxnQkFBZ0IsRUFBQTs7QUFMcEI7SUFTSSxlQUFlO0lBQ2YsZ0JBQWdCLEVBQUE7O0FBSXBCO0VBQ0UsZ0JBQWdCO0VBQ2hCLFlBQVk7RUFDWixnQkFBZ0IsRUFBQTs7QUFHbEI7RUFDRSw4QkFBOEIsRUFBQTs7QUFHaEM7RUFDRSxhQUFhO0VBQ2Isc0JBQXNCO0VBQ3RCLFlBQVksRUFBQTs7QUFHZDtFQUNFLFlBQVk7RUFDWixhQUFhO0VBQ2IsWUFBWTtFQUNaLG1CQUFtQjtFQUNuQixxQkFBcUIsRUFBQTs7QUFMdkI7SUFPSSx5QkFBeUI7SUFDekIsZ0JBQWdCO0lBQ2hCLFlBQVk7SUFDWixnQkFBZ0I7SUFDaEIsa0JBQWM7SUFDZCxrQkFBYztJQUNkLHFCQUFpQixFQUFBOztBQWJyQjtJQWdCSSxTQUFTO0lBQ1Qsb0JBQWdCO0lBQ2hCLGtCQUFjLEVBQUEiLCJmaWxlIjoic3JjL2FwcC9wYWdlcy9jaGF0LW1lc3NhZ2VzL2NoYXQtbWVzc2FnZXMucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiaW9uLWxpc3QsIC5tZXNzYWdlLWxpc3Rpbmcge1xyXG4gIHBhZGRpbmc6IDVweCAwO1xyXG4gIGZsZXg6IDE7XHJcbiAgb3ZlcmZsb3cteTogc2Nyb2xsO1xyXG4gIGRpc3BsYXk6IGZsZXg7XHJcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcclxufVxyXG5cclxuLnRleHQge1xyXG4gIGZvbnQtc2l6ZTogMTJweDtcclxuICB3aGl0ZS1zcGFjZTogcHJlLWxpbmU7XHJcbn1cclxuXHJcbi5jaGF0LXdyYXBwZXIge1xyXG4gIHdpZHRoOiAxMDAlO1xyXG4gIG1hcmdpbjogMTVweCAwO1xyXG5cclxuICBpb24taXRlbSB7XHJcbiAgICAtLWJvcmRlci13aWR0aDogMCAhaW1wb3J0YW50O1xyXG4gIH1cclxuXHJcbiAgLnRleHQge1xyXG4gICAgcGFkZGluZy1ib3R0b206IDVweDtcclxuICAgIG1hcmdpbjogNXB4O1xyXG4gICAgZm9udC1zaXplOiAxM3B0O1xyXG4gIH1cclxufVxyXG5cclxuLm1zZy1ibG9jayB7XHJcbiAgcGFkZGluZzogNXB4IDEwcHg7XHJcbiAgbWFyZ2luLWJvdHRvbTogMTBweDtcclxufVxyXG5cclxuLmNoYXQtc2VuZGVyIHtcclxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjZDNkM2QzO1xyXG4gIG1hcmdpbi1sZWZ0OiBhdXRvO1xyXG5cclxuICAudGV4dCB7XHJcbiAgICB0ZXh0LWFsaWduOiByaWdodDtcclxuICB9XHJcblxyXG4gIC50aW1lIHtcclxuICAgIGZvbnQtc2l6ZTogMTBwdDtcclxuICAgIHRleHQtYWxpZ246IHJpZ2h0O1xyXG4gIH1cclxufVxyXG5cclxuLmNoYXQtcmVjZWl2ZXIge1xyXG4gIGJhY2tncm91bmQtY29sb3I6ICNhZWQ4ZTY7XHJcbiAgbWFyZ2luLXJpZ2h0OiBhdXRvO1xyXG5cclxuICAudGV4dCB7XHJcbiAgICB0ZXh0LWFsaWduOiBsZWZ0O1xyXG4gIH1cclxuXHJcbiAgLnRpbWUge1xyXG4gICAgZm9udC1zaXplOiAxMHB0O1xyXG4gICAgdGV4dC1hbGlnbjogbGVmdDtcclxuICB9XHJcbn1cclxuXHJcbi5tZXNzYWdpbmcge1xyXG4gIG1pbi1oZWlnaHQ6IDQ1cHg7XHJcbiAgd2lkdGg6IDEwMHZ3O1xyXG4gIGJhY2tncm91bmQ6ICMwMDA7XHJcbn1cclxuXHJcbi5kYW5nZXIge1xyXG4gIGNvbG9yOiB2YXIoLS1pb24tY29sb3ItZGFuZ2VyKTtcclxufVxyXG5cclxuI21lc3NhZ2luZy1wYWdlIHtcclxuICBkaXNwbGF5OiBmbGV4O1xyXG4gIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XHJcbiAgaGVpZ2h0OiAxMDAlO1xyXG59XHJcblxyXG4jbWVzc2FnZS1lbnRyeSB7XHJcbiAgcGFkZGluZzogNXB4O1xyXG4gIGRpc3BsYXk6IGZsZXg7XHJcbiAgd2lkdGg6IDEwMHZ3O1xyXG4gIGZsZXgtZGlyZWN0aW9uOiByb3c7XHJcbiAgYWxpZ24taXRlbXM6IGZsZXgtZW5kO1xyXG4gIGlvbi10ZXh0YXJlYSB7XHJcbiAgICBib3JkZXI6IDFweCBzb2xpZCAjY2NjY2NjO1xyXG4gICAgYmFja2dyb3VuZDogI2ZmZjtcclxuICAgIGhlaWdodDogMzZweDtcclxuICAgIG1pbi1oZWlnaHQ6IDM2cHg7XHJcbiAgICAtLXBhZGRpbmctdG9wOiA1cHg7XHJcbiAgICAtLXBhZGRpbmctZW5kOiA1cHg7XHJcbiAgICAtLXBhZGRpbmctYm90dG9tOiA1cHg7XHJcbiAgfVxyXG4gIGlvbi1idXR0b24ge1xyXG4gICAgbWFyZ2luOiAwO1xyXG4gICAgLS1wYWRkaW5nLXN0YXJ0OiA4cHg7XHJcbiAgICAtLXBhZGRpbmctZW5kOiAycHg7XHJcbiAgfVxyXG59XHJcbiJdfQ== */\"","import { Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\r\nimport { ErrorsService } from '../../services/errors/errors.service';\r\nimport {\r\n  MessageService,\r\n  Message as ChatMessage,\r\n} from '../../services/message/message.service';\r\nimport { IonContent, LoadingController, NavController } from '@ionic/angular';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\r\nimport { Transphormer } from '../../services/authentication/authentication.service';\r\nimport * as moment from 'moment';\r\nimport { GlobalEmitterService, GlobalEvents } from '../../services/global-emitter/global-emitter.service';\r\nimport { ToastService } from '../../services/toast-service/toast-service.service';\r\nimport { AuthenticatedPusherService } from '../../services/authenticated-pusher/authenticated-pusher.service';\r\nimport { Subscription } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-chat-messages',\r\n  templateUrl: './chat-messages.page.html',\r\n  styleUrls: ['./chat-messages.page.scss'],\r\n})\r\nexport class ChatMessagesPage implements OnInit, OnDestroy {\r\n  public messages: ChatMessage[] = [];\r\n\r\n  protected toId: number;\r\n  public name: string;\r\n  protected groupName: string | null = null;\r\n\r\n  public messageForm: FormGroup;\r\n\r\n  private messageStream: Subscription;\r\n\r\n  @ViewChild('messageContent')\r\n  public messageContent: IonContent;\r\n\r\n  constructor(\r\n    public errorService: ErrorsService,\r\n    public navCtrl: NavController,\r\n    private messageService: MessageService,\r\n    private toastSvc: ToastService,\r\n    private loadingCtrl: LoadingController,\r\n    private router: ActivatedRoute,\r\n    private globalEmitter: GlobalEmitterService,\r\n    private toastService: ToastService,\r\n    public messageChannel: AuthenticatedPusherService\r\n  ) {\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.messageStream) {\r\n      this.messageStream.unsubscribe();\r\n    }\r\n\r\n    this.messageChannel.closeChannel(`private-message-channel.${this.toId}.${this.user.id}`);\r\n    this.messageChannel.closeEvent('message.received');\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.name = '?';\r\n    this.toId = parseFloat(this.router.snapshot.paramMap.get('id'));\r\n    this.groupName = this.router.snapshot.paramMap.get('groupName');\r\n\r\n    if (!this.groupName) {\r\n      this.groupName = null;\r\n    }\r\n\r\n    this.messageForm = new FormGroup({\r\n      message: new FormControl('', [Validators.required]),\r\n    });\r\n\r\n    this.getMessages();\r\n  }\r\n\r\n  private async getMessages() {\r\n    const loader = await this.loadingCtrl.create({\r\n      message: 'Please wait ...',\r\n    });\r\n\r\n    await loader.present();\r\n\r\n    try {\r\n      if (this.groupName === null) {\r\n        this.messages = <ChatMessage[]>(\r\n          (<any>await this.messageService.messages(this.toId))\r\n        ).sort((a, b) => moment(a.created_at).isBefore(moment(b.created_at)) ? -1 : 1);\r\n        this.setupMessageStream();\r\n      }\r\n\r\n      if (this.messages.length > 0) {\r\n        const message = this.messages[0];\r\n        if (message.from_id === this.toId) {\r\n          this.name = message.message_from.display_name;\r\n        } else {\r\n          this.name = message.message_to.display_name;\r\n        }\r\n      }\r\n\r\n      this.markMessagesAsRead();\r\n    } catch (e) {\r\n      this.toastSvc.flash(this.errorService.firstError(e));\r\n    } finally {\r\n      loader.dismiss();\r\n      this.scrollBottom();\r\n    }\r\n  }\r\n\r\n  public async sendMessage() {\r\n    const loader = await this.loadingCtrl.create({\r\n      message: 'Please wait ...',\r\n    });\r\n    await loader.present();\r\n\r\n    try {\r\n      let message;\r\n\r\n      if (this.groupName === null) {\r\n        message = <ChatMessage>(\r\n          (<any>(\r\n            await this.messageService.sendMessage(\r\n              this.toId,\r\n              this.messageForm.get('message').value\r\n            )\r\n          ))\r\n        );\r\n      } else {\r\n        message = <ChatMessage>(\r\n          (<any>(\r\n            await this.messageService.sendGroupMessage(\r\n              this.groupName,\r\n              this.messageForm.get('message').value\r\n            )\r\n          ))\r\n        );\r\n      }\r\n      this.messages.push(message);\r\n      this.messageForm.reset();\r\n\r\n      this.scrollBottom();\r\n    } catch (e) {\r\n      this.toastSvc.flash( this.errorService.firstError(e));\r\n    } finally {\r\n      loader.dismiss();\r\n    }\r\n  }\r\n\r\n  public get user(): Transphormer {\r\n    return JSON.parse(window.localStorage.getItem('transphormer'));\r\n  }\r\n\r\n  private setupMessageStream() {\r\n    this.messageChannel.openChannel(`private-message-channel.${this.toId}.${this.user.id}`);\r\n    this.messageStream = this.messageChannel.openEvent<{ message: ChatMessage }>('message.received')\r\n      .subscribe((data) => {\r\n        this.setupLatestMessages([data.message]);\r\n      });\r\n  }\r\n\r\n  private setupLatestMessages(messages: ChatMessage[]) {\r\n    let hasLatestMessage = false;\r\n    for (const message of messages) {\r\n      if (\r\n        !this.messages.find(\r\n          existingMessage => existingMessage.id === message.id\r\n        )\r\n      ) {\r\n        this.messages.push(message);\r\n        hasLatestMessage = true;\r\n      }\r\n    }\r\n\r\n    if (hasLatestMessage) {\r\n      this.messages = this.sortMessages();\r\n      this.scrollBottom();\r\n      this.markMessagesAsRead();\r\n    }\r\n  }\r\n\r\n  public scrollBottom() {\r\n    window.setTimeout(() => { this.messageContent.scrollToBottom(); }, 300);\r\n  }\r\n\r\n  public viewTransphormer() {\r\n    this.navCtrl.navigateForward(`details/${this.toId}`);\r\n  }\r\n\r\n  public time(created_at: string): string {\r\n    return moment\r\n      .utc(created_at)\r\n      .local()\r\n      .format('M/D/YYYY @ h:mm a');\r\n  }\r\n\r\n  private sortMessages() {\r\n    return this.messages.sort((a, b) => moment(a.created_at).isBefore(moment(b.created_at)) ? -1 : 1);\r\n  }\r\n\r\n  public async markMessagesAsRead() {\r\n\r\n    const unreadMessages = this.messages.filter(message => message.from_id !== this.user.id && !message.read_at);\r\n\r\n    try {\r\n      if (unreadMessages.length > 0) {\r\n        const result = await this.messageService.markMessagesAsRead(unreadMessages.map(message => message.id));\r\n        unreadMessages.forEach(message => {\r\n          message.read_at = result.read_at;\r\n        });\r\n        this.globalEmitter.emit(GlobalEvents.AdvisorMessageRead, { messages: unreadMessages, transphormerId: unreadMessages[0].from_id });\r\n      }\r\n    } catch (e) {\r\n      this.toastService.flash('Unable to mark messages as read.');\r\n    }\r\n  }\r\n}\r\n"],"sourceRoot":""}