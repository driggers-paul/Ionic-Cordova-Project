{"version":3,"sources":["webpack:///./src/app/pages/messages/messages.module.ts","webpack:///./src/app/pages/messages/messages.page.html","webpack:///./src/app/pages/messages/messages.page.scss","webpack:///./src/app/pages/messages/messages.page.ts"],"names":[],"mappings":"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","file":"pages-messages-messages-module.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { MessagesPage } from './messages.page';\r\nimport { AutoresizeModule } from '../../directives/autoresize/autoresize.module';\r\nimport { SideMenuModule } from '../../components/side-menu/side-menu.module';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: MessagesPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [\r\n    AutoresizeModule,\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    RouterModule.forChild(routes),\r\n    ReactiveFormsModule,\r\n    SideMenuModule\r\n  ],\r\n  declarations: [MessagesPage]\r\n})\r\nexport class MessagesPageModule {\r\n}\r\n","module.exports = \"<ion-header>\\r\\n  <ion-toolbar>\\r\\n    <ion-buttons slot=\\\"start\\\">\\r\\n      <app-menu-button></app-menu-button>\\r\\n    </ion-buttons>\\r\\n    <ion-buttons slot=\\\"end\\\" *ngIf=\\\"hasTrainer && canMessage\\\">\\r\\n      <ion-button (click)=\\\"trainerActionSheet()\\\" color=\\\"primary\\\" fill=\\\"clear\\\">\\r\\n        <ion-icon name=\\\"cog\\\"></ion-icon>\\r\\n      </ion-button>\\r\\n    </ion-buttons>\\r\\n    <ion-title>Advisor Messages</ion-title>\\r\\n  </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n<ion-content *ngIf=\\\"checkComplete && !hasTrainer\\\" padding>\\r\\n  <p>You don't currently have a Advisor.</p>\\r\\n  <p>Once you get an Advisor, your messages will show up here.</p>\\r\\n\\r\\n  <div class=\\\"button global-margin-top-25\\\">\\r\\n    <ion-button color=\\\"primary\\\" expand=\\\"full\\\" routerDirection=\\\"root\\\" routerLink=\\\"/trainer-requests\\\">Request an Advisor</ion-button>\\r\\n  </div>\\r\\n</ion-content>\\r\\n\\r\\n<div id=\\\"messaging-page\\\" *ngIf=\\\"checkComplete && hasTrainer\\\">\\r\\n  <ion-content class=\\\"message-listing\\\" *ngIf=\\\"canMessage\\\" #messageContent>\\r\\n    <div class=\\\"chat-wrapper\\\" *ngFor=\\\"let message of messages\\\" [class.chat-wrapper-receiver]=\\\"message.from_id === user.id\\\">\\r\\n      <div class=\\\"msg-block\\\" [class.chat-receiver]=\\\"message.from_id !== user.id\\\" [class.chat-sender]=\\\"message.from_id === user.id\\\">\\r\\n        <p class=\\\"text\\\" [innerHTML]=\\\"message.message\\\"></p>\\r\\n        <div class=\\\"time\\\">{{ time(message.created_at) }}</div>\\r\\n      </div>\\r\\n    </div>\\r\\n  </ion-content>\\r\\n\\r\\n  <div class=\\\"messaging\\\" *ngIf=\\\"canMessage\\\">\\r\\n    <form [formGroup]=\\\"messageForm\\\" (ngSubmit)=\\\"sendMessage()\\\">\\r\\n      <div id=\\\"message-entry\\\">\\r\\n        <ion-textarea autocapitalize=\\\"on\\\" appAutoresize (resize)=\\\"scrollBottom()\\\" formControlName=\\\"message\\\" placeholder=\\\"Message\\\"></ion-textarea>\\r\\n        <ion-button type=\\\"submit\\\" fill=\\\"clear\\\" [disabled]=\\\"messageForm.invalid\\\">\\r\\n          <ion-icon name=\\\"send\\\" slot=\\\"icon-only\\\"></ion-icon>\\r\\n        </ion-button>\\r\\n      </div>\\r\\n    </form>\\r\\n  </div>\\r\\n</div>\\r\\n\"","module.exports = \"ion-list, .message-listing {\\n  padding: 5px 0;\\n  flex: 1;\\n  overflow-y: scroll;\\n  display: flex;\\n  margin: 0 5vw;\\n  flex-direction: column; }\\n\\n.text {\\n  font-size: 12px;\\n  white-space: pre-line; }\\n\\n.chat-wrapper {\\n  margin: 15px 5vw; }\\n\\n.chat-wrapper ion-item {\\n    --border-width: 0 !important; }\\n\\n.chat-wrapper .text {\\n    padding-bottom: 5px;\\n    margin: 5px;\\n    font-size: 13pt; }\\n\\n.msg-block {\\n  padding: 5px 10px;\\n  margin-bottom: 10px; }\\n\\n.chat-sender {\\n  background-color: #d3d3d3;\\n  margin-left: 5vw; }\\n\\n.chat-sender .text {\\n    text-align: right; }\\n\\n.chat-sender .time {\\n    font-size: 10pt;\\n    text-align: right; }\\n\\n.chat-receiver {\\n  background-color: #aed8e6;\\n  margin-right: 5vw; }\\n\\n.chat-receiver .text {\\n    text-align: left; }\\n\\n.chat-receiver .time {\\n    font-size: 10pt;\\n    text-align: left; }\\n\\n.messaging {\\n  min-height: 45px;\\n  width: 100vw;\\n  background: #000; }\\n\\n.danger {\\n  color: var(--ion-color-danger); }\\n\\n#messaging-page {\\n  display: flex;\\n  flex-direction: column;\\n  height: 100%; }\\n\\n#message-entry {\\n  padding: 5px;\\n  display: flex;\\n  width: 100vw;\\n  flex-direction: row;\\n  align-items: flex-end; }\\n\\n#message-entry ion-textarea {\\n    background: #fff;\\n    height: 32px;\\n    line-height: 22px;\\n    min-height: 32px;\\n    --padding-top: 5px;\\n    --padding-start: 5px;\\n    --padding-end: 5px;\\n    --padding-bottom: 5px; }\\n\\n#message-entry ion-button {\\n    height: auto;\\n    margin: 0;\\n    --padding-start: 8px;\\n    --padding-end: 2px; }\\n\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvcGFnZXMvbWVzc2FnZXMvRTpcXGlvbmljXFxWZXJ2ZUNvbW1lcmNlXFxOZXdEZXZcXG10c3QtYXBwL3NyY1xcYXBwXFxwYWdlc1xcbWVzc2FnZXNcXG1lc3NhZ2VzLnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGNBQWM7RUFDZCxPQUFPO0VBQ1Asa0JBQWtCO0VBQ2xCLGFBQWE7RUFDYixhQUFhO0VBQ2Isc0JBQXNCLEVBQUE7O0FBR3hCO0VBQ0UsZUFBZTtFQUNmLHFCQUFxQixFQUFBOztBQUd2QjtFQUNFLGdCQUFnQixFQUFBOztBQURsQjtJQUlJLDRCQUFlLEVBQUE7O0FBSm5CO0lBUUksbUJBQW1CO0lBQ25CLFdBQVc7SUFDWCxlQUFlLEVBQUE7O0FBSW5CO0VBQ0UsaUJBQWlCO0VBQ2pCLG1CQUFtQixFQUFBOztBQUdyQjtFQUNFLHlCQUF5QjtFQUN6QixnQkFBZ0IsRUFBQTs7QUFGbEI7SUFLSSxpQkFBaUIsRUFBQTs7QUFMckI7SUFTSSxlQUFlO0lBQ2YsaUJBQWlCLEVBQUE7O0FBSXJCO0VBQ0UseUJBQXlCO0VBQ3pCLGlCQUFpQixFQUFBOztBQUZuQjtJQUtJLGdCQUFnQixFQUFBOztBQUxwQjtJQVNJLGVBQWU7SUFDZixnQkFBZ0IsRUFBQTs7QUFJcEI7RUFDRSxnQkFBZ0I7RUFDaEIsWUFBWTtFQUNaLGdCQUFnQixFQUFBOztBQUdsQjtFQUNFLDhCQUE4QixFQUFBOztBQUdoQztFQUNFLGFBQWE7RUFDYixzQkFBc0I7RUFDdEIsWUFBWSxFQUFBOztBQUdkO0VBQ0UsWUFBWTtFQUNaLGFBQWE7RUFDYixZQUFZO0VBQ1osbUJBQW1CO0VBQ25CLHFCQUFxQixFQUFBOztBQUx2QjtJQU9JLGdCQUFnQjtJQUNoQixZQUFZO0lBQ1osaUJBQWlCO0lBQ2pCLGdCQUFnQjtJQUNoQixrQkFBYztJQUNkLG9CQUFnQjtJQUNoQixrQkFBYztJQUNkLHFCQUFpQixFQUFBOztBQWRyQjtJQWlCSSxZQUFZO0lBQ1osU0FBUztJQUNULG9CQUFnQjtJQUNoQixrQkFBYyxFQUFBIiwiZmlsZSI6InNyYy9hcHAvcGFnZXMvbWVzc2FnZXMvbWVzc2FnZXMucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiaW9uLWxpc3QsIC5tZXNzYWdlLWxpc3Rpbmcge1xyXG4gIHBhZGRpbmc6IDVweCAwO1xyXG4gIGZsZXg6IDE7XHJcbiAgb3ZlcmZsb3cteTogc2Nyb2xsO1xyXG4gIGRpc3BsYXk6IGZsZXg7XHJcbiAgbWFyZ2luOiAwIDV2dztcclxuICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xyXG59XHJcblxyXG4udGV4dCB7XHJcbiAgZm9udC1zaXplOiAxMnB4O1xyXG4gIHdoaXRlLXNwYWNlOiBwcmUtbGluZTtcclxufVxyXG5cclxuLmNoYXQtd3JhcHBlciB7XHJcbiAgbWFyZ2luOiAxNXB4IDV2dztcclxuXHJcbiAgaW9uLWl0ZW0ge1xyXG4gICAgLS1ib3JkZXItd2lkdGg6IDAgIWltcG9ydGFudDtcclxuICB9XHJcblxyXG4gIC50ZXh0IHtcclxuICAgIHBhZGRpbmctYm90dG9tOiA1cHg7XHJcbiAgICBtYXJnaW46IDVweDtcclxuICAgIGZvbnQtc2l6ZTogMTNwdDtcclxuICB9XHJcbn1cclxuXHJcbi5tc2ctYmxvY2sge1xyXG4gIHBhZGRpbmc6IDVweCAxMHB4O1xyXG4gIG1hcmdpbi1ib3R0b206IDEwcHg7XHJcbn1cclxuXHJcbi5jaGF0LXNlbmRlciB7XHJcbiAgYmFja2dyb3VuZC1jb2xvcjogI2QzZDNkMztcclxuICBtYXJnaW4tbGVmdDogNXZ3O1xyXG5cclxuICAudGV4dCB7XHJcbiAgICB0ZXh0LWFsaWduOiByaWdodDtcclxuICB9XHJcblxyXG4gIC50aW1lIHtcclxuICAgIGZvbnQtc2l6ZTogMTBwdDtcclxuICAgIHRleHQtYWxpZ246IHJpZ2h0O1xyXG4gIH1cclxufVxyXG5cclxuLmNoYXQtcmVjZWl2ZXIge1xyXG4gIGJhY2tncm91bmQtY29sb3I6ICNhZWQ4ZTY7XHJcbiAgbWFyZ2luLXJpZ2h0OiA1dnc7XHJcblxyXG4gIC50ZXh0IHtcclxuICAgIHRleHQtYWxpZ246IGxlZnQ7XHJcbiAgfVxyXG5cclxuICAudGltZSB7XHJcbiAgICBmb250LXNpemU6IDEwcHQ7XHJcbiAgICB0ZXh0LWFsaWduOiBsZWZ0O1xyXG4gIH1cclxufVxyXG5cclxuLm1lc3NhZ2luZyB7XHJcbiAgbWluLWhlaWdodDogNDVweDtcclxuICB3aWR0aDogMTAwdnc7XHJcbiAgYmFja2dyb3VuZDogIzAwMDtcclxufVxyXG5cclxuLmRhbmdlciB7XHJcbiAgY29sb3I6IHZhcigtLWlvbi1jb2xvci1kYW5nZXIpO1xyXG59XHJcblxyXG4jbWVzc2FnaW5nLXBhZ2Uge1xyXG4gIGRpc3BsYXk6IGZsZXg7XHJcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcclxuICBoZWlnaHQ6IDEwMCU7XHJcbn1cclxuXHJcbiNtZXNzYWdlLWVudHJ5IHtcclxuICBwYWRkaW5nOiA1cHg7XHJcbiAgZGlzcGxheTogZmxleDtcclxuICB3aWR0aDogMTAwdnc7XHJcbiAgZmxleC1kaXJlY3Rpb246IHJvdztcclxuICBhbGlnbi1pdGVtczogZmxleC1lbmQ7XHJcbiAgaW9uLXRleHRhcmVhIHtcclxuICAgIGJhY2tncm91bmQ6ICNmZmY7XHJcbiAgICBoZWlnaHQ6IDMycHg7XHJcbiAgICBsaW5lLWhlaWdodDogMjJweDtcclxuICAgIG1pbi1oZWlnaHQ6IDMycHg7XHJcbiAgICAtLXBhZGRpbmctdG9wOiA1cHg7XHJcbiAgICAtLXBhZGRpbmctc3RhcnQ6IDVweDtcclxuICAgIC0tcGFkZGluZy1lbmQ6IDVweDtcclxuICAgIC0tcGFkZGluZy1ib3R0b206IDVweDtcclxuICB9XHJcbiAgaW9uLWJ1dHRvbiB7XHJcbiAgICBoZWlnaHQ6IGF1dG87XHJcbiAgICBtYXJnaW46IDA7XHJcbiAgICAtLXBhZGRpbmctc3RhcnQ6IDhweDtcclxuICAgIC0tcGFkZGluZy1lbmQ6IDJweDtcclxuICB9XHJcbn1cclxuIl19 */\"","import { Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\r\nimport {\r\n  ActionSheetController,\r\n  IonContent,\r\n  LoadingController,\r\n  NavController,\r\n} from '@ionic/angular';\r\nimport { ErrorsService } from '../../services/errors/errors.service';\r\nimport {\r\n  LinkApplication,\r\n  TrainerTransphormerLinkService,\r\n} from '../../services/trainer-transphormer-link/trainer-transphormer-link.service';\r\nimport {\r\n  MessageService,\r\n  Message as ChatMessage,\r\n} from '../../services/message/message.service';\r\nimport { Transphormer } from '../../services/authentication/authentication.service';\r\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\r\nimport * as moment from 'moment';\r\nimport { ToastService } from '../../services/toast-service/toast-service.service';\r\nimport { GlobalEmitterService, GlobalEvents } from '../../services/global-emitter/global-emitter.service';\r\nimport { AuthenticatedPusherService } from '../../services/authenticated-pusher/authenticated-pusher.service';\r\nimport { Subscription } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-messages',\r\n  templateUrl: './messages.page.html',\r\n  styleUrls: ['./messages.page.scss'],\r\n})\r\nexport class MessagesPage implements OnInit, OnDestroy {\r\n  public application: LinkApplication | null = null;\r\n\r\n  public hasTrainer = false;\r\n  public checkComplete = false;\r\n  public canMessage = false;\r\n\r\n  public messageForm: FormGroup;\r\n\r\n  public messages: ChatMessage[] = [];\r\n\r\n  private messageStream: Subscription;\r\n\r\n  @ViewChild('messageContent')\r\n  public messageContent: IonContent;\r\n\r\n\r\n  constructor(\r\n    private toastSvc: ToastService,\r\n    private loadingCtrl: LoadingController,\r\n    private linkService: TrainerTransphormerLinkService,\r\n    public errorService: ErrorsService,\r\n    private messageService: MessageService,\r\n    private actionSheetCtrl: ActionSheetController,\r\n    private navCtrl: NavController,\r\n    private toastService: ToastService,\r\n    private globalEmitter: GlobalEmitterService,\r\n    public messageChannel: AuthenticatedPusherService\r\n  ) {\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    if (this.messageStream) {\r\n      this.messageStream.unsubscribe();\r\n      this.messageChannel.closeChannel(`private-message-channel.${this.application.trainer.transphormer_id}.${this.user.id}`);\r\n      this.messageChannel.closeEvent('message.received');\r\n    }\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.checkApplicationStatus();\r\n\r\n    this.messageForm = new FormGroup({\r\n      message: new FormControl('', [Validators.required]),\r\n    });\r\n  }\r\n\r\n  private async checkApplicationStatus() {\r\n    const loader = await this.loadingCtrl.create({\r\n      message: 'Please wait ...',\r\n    });\r\n\r\n    await loader.present();\r\n\r\n    try {\r\n      this.application = <LinkApplication>(\r\n        await this.linkService.requestStatus()\r\n      );\r\n      this.hasTrainer = true;\r\n\r\n      if (this.application.status === 'accepted') {\r\n        this.canMessage = true;\r\n        await this.setupMessages();\r\n      }\r\n    } catch (e) {\r\n      if (e.status !== 404) {\r\n        this.toastSvc.flash(this.errorService.firstError(e));\r\n      }\r\n    } finally {\r\n      loader.dismiss();\r\n      this.checkComplete = true;\r\n    }\r\n  }\r\n\r\n  private async setupMessages(showLoader = false) {\r\n    let loader;\r\n\r\n    if (!this.application) {\r\n      this.hasTrainer = false;\r\n    } else {\r\n      if (showLoader) {\r\n        loader = await this.loadingCtrl.create({\r\n          message: 'Please wait ...',\r\n        });\r\n        await loader.present();\r\n      }\r\n\r\n      try {\r\n        this.messages = <ChatMessage[]>(\r\n          (<any>(\r\n            await this.messageService.messages(\r\n              this.application.trainer.transphormer.id\r\n            )\r\n          ))\r\n        );\r\n        this.messages = this.sortMessages();\r\n        this.setupMessageStream();\r\n        this.markMessagesAsRead();\r\n\r\n        this.scrollBottom();\r\n      } catch (e) {\r\n        this.toastSvc.flash(this.errorService.firstError(e));\r\n      } finally {\r\n        if (showLoader) {\r\n          await loader.dismiss();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public get user(): Transphormer {\r\n    return JSON.parse(window.localStorage.getItem('transphormer'));\r\n  }\r\n\r\n  public async sendMessage() {\r\n    const loader = await this.loadingCtrl.create({\r\n      message: 'Please wait ...',\r\n    });\r\n    await loader.present();\r\n\r\n    try {\r\n      const message = <ChatMessage>(\r\n        (<any>(\r\n          await this.messageService.sendMessage(\r\n            this.application.trainer.transphormer.id,\r\n            this.messageForm.get('message').value\r\n          )\r\n        ))\r\n      );\r\n      this.messages.push(message);\r\n      this.messageForm.reset();\r\n      this.scrollBottom();\r\n    } catch (e) {\r\n      this.toastSvc.flash(this.errorService.firstError(e));\r\n    } finally {\r\n      loader.dismiss();\r\n    }\r\n  }\r\n\r\n  private setupMessageStream() {\r\n    this.messageChannel.openChannel(`private-message-channel.${this.application.trainer.transphormer_id}.${this.user.id}`);\r\n    this.messageStream = this.messageChannel.openEvent<{ message: ChatMessage }>('message.received')\r\n      .subscribe((data) => {\r\n        this.setupLatestMessages([data.message]);\r\n      });\r\n  }\r\n\r\n  private setupLatestMessages(messages: ChatMessage[]) {\r\n    let hasNewMessage = false;\r\n    for (const message of messages) {\r\n      if (\r\n        !this.messages.find(\r\n          existingMessage => existingMessage.id === message.id\r\n        )\r\n      ) {\r\n        this.messages.push(message);\r\n        hasNewMessage = true;\r\n      }\r\n    }\r\n\r\n    if (hasNewMessage) {\r\n      this.messages = this.sortMessages();\r\n      this.scrollBottom();\r\n      this.markMessagesAsRead();\r\n    }\r\n  }\r\n\r\n  public time(created_at: string): string {\r\n    return moment\r\n      .utc(created_at)\r\n      .local()\r\n      .format('h:mm a');\r\n  }\r\n\r\n  public async trainerActionSheet() {\r\n    const actionSheet = await this.actionSheetCtrl.create({\r\n      buttons: [\r\n        {\r\n          text: 'Remove Advisor',\r\n          icon: 'trash',\r\n          cssClass: 'danger',\r\n          handler: () => {\r\n            this.removeTrainer();\r\n          },\r\n        },\r\n        {\r\n          text: 'View Advisor details',\r\n          icon: 'eye',\r\n          handler: () => {\r\n            this.navCtrl.navigateForward(\r\n              `/trainer-detail/${this.application.trainer.transphormer_id}`\r\n            );\r\n          },\r\n        },\r\n        {\r\n          text: 'Cancel',\r\n        },\r\n      ],\r\n    });\r\n    await actionSheet.present();\r\n  }\r\n\r\n  private async removeTrainer() {\r\n    const loader = await this.loadingCtrl.create({\r\n      message: 'Please wait ...',\r\n    });\r\n    await loader.present();\r\n\r\n    try {\r\n      await this.linkService.destroyLink(this.application.id);\r\n      this.hasTrainer = false;\r\n      this.canMessage = false;\r\n    } catch (e) {\r\n      this.toastSvc.flash(this.errorService.firstError(e));\r\n    } finally {\r\n      loader.dismiss();\r\n    }\r\n  }\r\n\r\n  public scrollBottom() {\r\n    window.setTimeout(() => this.messageContent.scrollToBottom(), 100);\r\n  }\r\n\r\n  private sortMessages() {\r\n    return this.messages.sort((a, b) => moment(a.created_at).isBefore(moment(b.created_at)) ? -1 : 1);\r\n  }\r\n\r\n  public async markMessagesAsRead() {\r\n\r\n    const unreadMessages = this.messages.filter(message => message.from_id !== this.user.id && !message.read_at);\r\n\r\n    try {\r\n      if (unreadMessages.length > 0) {\r\n        const result = await this.messageService.markMessagesAsRead(unreadMessages.map(message => message.id));\r\n        unreadMessages.forEach(message => {\r\n          message.read_at = result.read_at;\r\n        });\r\n      }\r\n\r\n      this.globalEmitter.emit(GlobalEvents.TransphormerMessageRead);\r\n    } catch (e) {\r\n      this.toastService.flash('Unable to mark messages as read');\r\n    }\r\n  }\r\n}\r\n"],"sourceRoot":""}